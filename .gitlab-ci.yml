variables:
  # https://gitlab.cern.ch/cms-cactus/ops/auto-devops/blob/master/tasks/variables/rpm-project.yml
  AUTO_DEVOPS_BUILD_IMAGE: ${CI_REGISTRY_IMAGE}/builder:4-oms-documentation-cc7
  AUTO_DEVOPS_TEST_IMAGE: ${CI_REGISTRY_IMAGE}/builder:4-oms-documentation-cc7
  AUTO_DEVOPS_DOCS_BUILD_TYPE: markdown
  AUTO_DEVOPS_RPM_PUBLISH_BRANCH_REGEX: /master/
  AUTO_DEVOPS_RPM_CERNBOX_FOLDER: /eos/user/a/avwebd2/ratemon_builds/$CI_COMMIT_REF_NAME/centos7_x86_64/base/RPMS/
  AUTO_DEVOPS_DOCKER_DISABLED: "true"

include:
  - project: cms-cactus/ops/auto-devops
    ref: 0.0.1
    file: project-types/rpm-project.yml

builder image:
  extends: .auto_devops_docker_image_tagged_template
  stage: preflight
  variables:
    BASE_OS: cc7
    BASE_TAG: 20200504-1.x86_64
    NAME: builder
    DOCKERFILE: builder.Dockerfile

OMS base image:
  extends: .auto_devops_docker_image_tagged_template
  stage: preflight
  variables:
    BASE_OS: cc7
    BASE_TAG: 20200504-1.x86_64
    NAME: oms-base
    DOCKERFILE: oms-base.Dockerfile
    CONTEXT_FOLDER: oms

OMS builder image:
  extends: .auto_devops_docker_image_tagged_template
  stage: preflight
  variables:
    BASE_OS: cc7
    NAME: oms-builder
    DOCKERFILE: oms-builder.Dockerfile
    CONTEXT_FOLDER: oms
  needs:
  - OMS base image



# build_rpm:
#   stage: rpm
#   image: gitlab-registry.cern.ch/avivace/ratemon/builder
#   script:
#     # deploy-eos copies the content of the 'public' folder inside the specified
#     # eos share
#     - mkdir public
#     - make rpm
#     - mv *.rpm public/
#   artifacts:
#     paths:
#       - public
#     # Make it vanish in 1 hour
#     expire_in: 1 hour

# # https://gitlab.cern.ch/ci-tools/ci-web-deployer
# deploy-eos:
#   stage: deploy
#   image: gitlab-registry.cern.ch/ci-tools/ci-web-deployer:latest
#   script:
#     - deploy-eos
